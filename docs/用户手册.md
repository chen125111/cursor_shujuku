




# 气体混合物数据管理系统 V4.0





# 用户手册
User's Manual




**《用户操作详细介绍》**

---

## 一、简介

气体混合物数据管理系统是一款面向气体水合物研究领域的专业数据管理与查询平台，旨在为科研人员、工程师及相关领域从业者提供高效、便捷的气体水合物相平衡实验数据存储、检索与分析功能。

系统采用现代化的 B/S（浏览器/服务器）架构，后端使用 FastAPI 提供高性能 RESTful API，支持多组分气体（甲烷 CH₄、乙烷 C₂H₆、丙烷 C₃H₈、二氧化碳 CO₂、氮气 N₂、硫化氢 H₂S、异丁烷 i-C₄H₁₀ 等）在不同温度条件下的相平衡压力数据管理与智能查询。

系统重点提供后端数据服务能力，包括相平衡查询、数据管理、批量导入导出、数据审核、用户权限与安全审计、备份恢复等功能，可广泛应用于实验室数据归档、科研文献数据整理、工业生产参数参考等场景，为气体水合物研究与应用提供可靠的数据支撑。

---

### 1.0 前言

气体水合物作为一种由气体分子与水分子在低温高压条件下形成的笼型晶体化合物，其相平衡特性对能源开发、油气运输、环境保护等领域具有重要影响。准确掌握水合物相平衡数据是避免生产中堵塞风险、优化开采工艺的关键前提。

传统的实验数据管理方式（如 Excel 表格、纸质记录）存在数据分散、查询困难、共享不便等问题。本系统通过建立标准化的数据库结构和智能化的查询接口，实现了实验数据的集中管理、快速检索和高效共享，解决了传统方法在实际应用中的局限性。

为帮助用户快速掌握系统的安装配置、功能操作及结果解读，特编写本用户手册。手册详细介绍了系统的核心功能、使用流程、注意事项及常见问题解答，适用于具备基础热力学知识的科研人员和工程技术人员。

本系统版本为 4.0，后续将根据用户反馈持续优化功能，提升查询性能与使用体验。

---

### 1.1 编写目的

本用户手册（版本 V4.0）旨在为气体混合物数据管理系统的用户提供全面、清晰的操作指导，确保用户能够快速掌握系统的安装配置、功能使用及结果解读，具体目的如下：

1. **降低使用门槛**：通过分步说明系统的核心功能（如相平衡查询、数据管理、批量导入导出等），帮助科研人员、工程师及相关领域从业者快速上手，无需深入了解数据库底层逻辑即可完成数据操作。

2. **规范操作流程**：明确系统的输入参数要求（如温度范围、气体组分摩尔分数等）、操作步骤及注意事项，减少因参数错误或操作不当导致的查询偏差，确保结果的可靠性。

3. **解读功能价值**：详细说明系统的数据管理能力（支持 SQLite/MySQL 双数据库）与安全防护机制（JWT 认证、两步验证、API 限流），帮助用户理解系统的技术优势，合理应用于科研实验设计、工业工艺优化等场景。

4. **解决常见问题**：针对用户登录、数据导入、结果导出等可能出现的问题提供解决方案，辅助用户高效排查异常，保障系统稳定运行。

5. **适配版本特性**：针对 4.0 版本中新增的智能组分组合查询、增强的可视化功能及数据审核模块，专项说明其使用方法，充分发挥版本更新带来的性能提升。

本手册适用于具备基础热力学知识的用户，既可作为新手入门指南，也可作为日常操作的参考手册，助力用户充分发挥系统在气体水合物相平衡研究与应用中的价值。

---

### 1.2 系统名称及版本号

| 项目 | 内容 |
|------|------|
| **系统名称** | 气体混合物数据管理系统 |
| **英文名称** | Gas Mixture Data Management System |
| **版本号** | V4.0 |
| **发布日期** | 2026年1月 |

---

### 1.3 软件功能体现

本气体混合物数据管理系统通过后端服务集成数据管理与查询分析能力，主要功能体现在以下方面：

| 功能模块 | 功能描述 |
|---------|---------|
| **智能查询模式** | 支持按组分组合、温度范围、精确组分配比等多种方式查询相平衡压力数据 |
| **灵活的数据管理** | 提供数据的增删改查、批量导入导出（CSV/Excel）、数据校验等功能 |
| **多维度结果展示** | 通过表格、图表（温度分布、压力分布、热力图）等形式展示数据 |
| **完善的安全机制** | 集成 JWT 认证、TOTP 两步验证、API 限流、登录审计等安全功能 |
| **数据审核管理** | 支持重复数据检测、待审核数据处理、数据历史追溯 |
| **备份与恢复** | 自动/手动备份、备份文件管理、一键恢复 |

---

### 1.4 使用者

所有使用气体混合物数据管理系统的客户及工程技术人员，包括但不限于：

- 气体水合物研究领域的科研人员
- 油气开发与管道运输工程师
- 实验室数据管理人员
- 高校相关专业教学人员与学生
- 化工、能源行业技术人员

---

### 1.5 使用范围

本系统适用于对含甲烷、乙烷、丙烷、二氧化碳、氮气、硫化氢、异丁烷等 7 种组分的单组分/多组分气体体系的水合物相平衡实验数据进行管理与查询，具体包括：

**适用场景：**
- 实验室相平衡实验数据的录入、存储与检索
- 科研文献中实验数据的整理与归档
- 工业生产中相平衡参数的快速参考
- 教学演示与学术研究数据支持

**系统限制：**
- 数据范围取决于数据库中已录入的实验数据
- 不提供理论计算或预测功能（仅提供实验数据查询）
- 需确保输入的组分摩尔分数之和为 1.0

---

## 二、操作术语

### 2.1 系统架构说明

本系统采用前后端分离的 B/S 架构，具体组成如下：

![系统架构图](architecture.png)

**后端核心职责：**

| 模块 | 说明 |
|------|------|
| API 网关 | 统一入口 `/api`，提供 RESTful 服务 |
| 数据服务 | 数据库读写、筛选、分页、统计 |
| 安全服务 | JWT、限流、防爬虫、审计日志 |
| 备份服务 | 定期备份、恢复、下载 |

架构图仅展示逻辑分层。实际部署中，可通过 Docker 或云服务进行扩展与高可用配置。

---

### 2.2 后端服务与接口入口

后端服务默认监听 `http://服务器地址:8000`，API 基础路径为 `/api`，交互式文档入口为 `/docs`（Swagger UI）。服务采用 JSON 作为主要的请求与响应格式，文件上传使用 `multipart/form-data`。

![API 文档界面示意](screenshots/api-docs.png)

**图片说明：**该界面为 Swagger UI 形式的 API 文档入口，适合开发、测试与运维人员快速了解系统的后端能力。页面左侧按业务分组（如 Records、Auth、Review）组织接口列表，右侧会展示接口的参数说明、请求示例、响应结构与状态码含义。实际使用中，建议先确认接口所属分组，再展开查看参数约束与必填字段，从而避免请求格式错误。

**重要按钮/图标说明：**分组折叠/展开是高频操作入口，能够把长列表按模块收起，快速定位目标接口并减少滚动成本；`/openapi.json` 链接用于导出 OpenAPI 描述文件，可导入 Postman、Apifox、Swagger Editor 等工具进行二次整理或生成 SDK；`Try it out` 可以直接在浏览器内发起请求并查看响应，适合做参数联调与返回格式校验，但线上环境需注意权限与敏感数据暴露风险。

**常用入口：**

| 入口 | 说明 |
|------|------|
| `/api` | 后端 API 基础路径 |
| `/docs` | 交互式 API 文档（Swagger UI） |
| `/openapi.json` | OpenAPI 描述文件 |

**响应格式约定：**

```json
{
  "success": true,
  "message": "操作成功",
  "data": { }
}
```

---

### 2.3 认证与权限术语

为便于后端接口调用，以下术语在本手册中统一使用：

| 术语 | 说明 |
|------|------|
| **JWT Token** | 登录后颁发的访问令牌，写入请求头 `Authorization: Bearer <token>` |
| **admin / user** | 系统角色，管理员具备用户管理、批量操作与审核权限 |
| **会话 Session** | 记录用户登录状态与设备信息，可被撤销 |
| **限流 Rate Limit** | 对同一 IP 的请求频率限制，防止滥用 |
| **审计日志 Audit Log** | 记录敏感操作以便追踪 |

---

## 三、核心功能详解

### 3.1 相平衡查询接口

后端提供多种查询接口，用于按组分与温度检索相平衡压力数据：

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/query` | 按组分摩尔分数查询 |
| POST | `/api/query/by-components` | 按组分组合 + 温度查询 |
| POST | `/api/query/hydrate` | 水合物相平衡智能匹配 |
| POST | `/api/components/available` | 查询可继续组合的组分 |
| POST | `/api/components/ranges` | 查询组分可用范围 |

**典型流程：**

1. 先调用 `/api/components/available` 获取可组合的组分列表  
2. 再调用 `/api/components/ranges` 获取组分区间与温度范围  
3. 最后调用 `/api/query/hydrate` 或 `/api/query/by-components` 获取相平衡压力  

**示例（POST /api/query/hydrate）：**

```json
{
  "components": {
    "x_ch4": 0.9,
    "x_c2h6": 0.1
  },
  "temperature": 275,
  "tolerance": 0.02
}
```

**响应字段：**

| 字段 | 说明 |
|------|------|
| temperature | 匹配温度 |
| pressure | 相平衡压力 |
| match_score | 匹配度评分 |

---

### 3.2 认证与会话

后端采用 JWT 认证，登录后获取 `access_token` 并在请求头中携带。

![管理入口登录界面](screenshots/admin-login.png)

**图片说明：**后台登录入口用于获取 JWT Token，是所有管理功能的访问起点。该页面强调账号与密码的正确性，登录成功后会建立会话并允许访问后续模块。由于此入口通常仅对管理员或具备权限的用户开放，建议部署时明确账号来源与密码策略。

**重要按钮/提示说明：**“登 录”按钮会提交账号与密码并触发认证流程，成功后系统会返回 Token 并缓存到本地用于后续 API 调用；页面底部的提示文案明确管理员账号与密码来源于环境变量，便于运维人员在不同环境（开发/测试/生产）切换配置并定位登录失败原因。

**通用说明（仅此处出现）：**后续管理后台截图左侧导航栏相同，包含模块入口（系统概览、数据记录、审核、导入导出、用户管理等），不再重复说明。

**管理后台概览（登录后）：**

![管理后台概览](screenshots/admin-overview.png)

**图片说明：**系统概览页用于快速感知系统状态与数据规模，适合日常运维或管理人员进行“快速巡检”。页面上方的统计卡片汇总了记录数量、温度/压力分布范围、数据库体量等关键指标，下方“最近数据记录”与“系统信息”区域则提供时间维度与运行环境的补充信息。通过该页可初步判断数据是否持续写入、指标是否异常，以及系统是否处于可用状态。

**重要按钮/图标说明：**右上角“🔄 刷新”会重新拉取统计与状态数据，建议在导入、审核或删除数据后手动刷新以同步最新结果；统计卡片是最直观的健康指标，若范围值或记录数突然变动，应结合日志排查；“查看全部”会跳转到数据记录列表，便于快速定位并核查异常数据或最近变更记录。

**请求头示例：**

```http
Authorization: Bearer <token>
```

**登录示例（curl）：**

```bash
curl -X POST http://127.0.0.1:8000/api/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"admin\",\"password\":\"YOUR_PASSWORD\"}"
```

**响应示例：**

```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "access_token": "eyJhbGciOi...",
    "token_type": "bearer",
    "user": { "username": "admin", "role": "admin" },
    "totp_enabled": false
  }
}
```

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/auth/login` | 登录获取 Token |
| GET | `/api/auth/me` | 查询当前用户 |
| POST | `/api/auth/logout` | 退出登录 |
| POST | `/api/auth/change-password` | 修改密码 |

**TOTP 两步验证接口：**

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/auth/totp/setup` | 生成密钥与二维码 |
| POST | `/api/auth/totp/enable` | 启用两步验证 |
| POST | `/api/auth/totp/disable` | 禁用两步验证 |
| GET | `/api/auth/totp/status` | 查询两步验证状态 |
| POST | `/api/auth/totp/backup-codes` | 生成备用码 |

**用户管理模块界面：**

![用户管理](screenshots/admin-users.png)

**图片说明：**用户管理页面聚合了用户列表、密码管理与安全信息三块内容，便于管理员统一管理账号与权限。上方列表用于查看用户角色与状态，中间区域提供修改当前用户密码的入口，下方安全信息展示系统认证方式与 Token 有效期。该页面适合作为账号生命周期管理的中心入口。

**重要按钮/图标说明：**“➕ 添加用户”用于创建新账号并分配角色，建议在新增人员或权限变更时使用；“重置密码”适用于用户遗忘密码或需要强制更换的场景；“撤销会话”会强制指定用户下线，常用于权限回收或异常登录处理；“🔑 修改密码”则用于当前登录用户更新自身密码，完成后建议重新登录以验证新密码生效。

---

### 3.3 数据管理 API

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/records` | 分页获取记录 | 否 |
| GET | `/api/records/{id}` | 获取单条记录 | 否 |
| POST | `/api/records` | 创建记录 | 是 |
| PUT | `/api/records/{id}` | 更新记录 | 是 |
| DELETE | `/api/records/{id}` | 删除记录 | 是 |

**数据记录模块界面：**

![数据记录列表](screenshots/admin-records.png)

**图片说明：**数据记录页面以表格形式展示核心实验数据，包括温度、压力与各组分摩尔分数，是数据核对与追溯的主要入口。该页面通常用于检查单条数据的完整性、对比不同组分组合的变化趋势，以及为后续审核或导出提供基础依据。数据量较大时，通过分页加载减少一次性渲染压力。

**重要按钮/图标说明：**“🔄 刷新”会重新拉取当前页数据，适合在导入、更新或删除操作后进行同步；“加载更多”用于分页加载后续记录，避免一次性加载过多数据影响页面性能与响应速度。

**筛选参数（/api/records）：**

- `page`、`per_page`：分页控制  
- `temp_min`、`temp_max`：温度范围  
- `pressure_min`、`pressure_max`：压力范围

**创建记录示例（curl）：**

```bash
curl -X POST http://127.0.0.1:8000/api/records ^
  -H "Content-Type: application/json" ^
  -H "Authorization: Bearer <token>" ^
  -d "{
    \"temperature\": 275,
    \"pressure\": 2.5,
    \"x_ch4\": 0.9,
    \"x_c2h6\": 0.1
  }"
```

**响应示例：**

```json
{
  "success": true,
  "message": "创建成功",
  "data": { "id": 1024 }
}
```

**数据校验与软提示：**

- 温度、压力、组分数值范围校验  
- 组分总和偏差超过阈值会提示但不阻止保存  
- 压力超阈值记录软提示（便于后续审核）

---

### 3.4 批量导入导出

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/export/csv` | 导出 CSV | 是 |
| GET | `/api/export/excel` | 导出 Excel | 是 |
| POST | `/api/import` | 导入文件 | 是 |
| POST | `/api/import/preview` | 导入预校验 | 是 |
| GET | `/api/template/csv` | 下载 CSV 模板 | 否 |
| GET | `/api/template/excel` | 下载 Excel 模板 | 否 |

**导入导出模块界面：**

![导入导出](screenshots/admin-import-export.png)

**图片说明：**导入导出页面是批量数据处理的核心入口，支持 CSV/Excel 文件上传、预校验与标准模板下载。该页面适合在实验数据集中整理、文献数据迁移或周期性数据归档时使用。通过预校验可以提前识别格式错误或异常值，避免污染正式数据。

**重要按钮/图标说明：**“📁 选择文件导入”会上传并触发导入流程，适合数据格式已确认时使用；“🔍 校验预览”会先进行格式与规则检查，返回错误与警告，建议在正式导入前优先使用；模板下载按钮提供标准 CSV/Excel 格式，便于统一数据结构；“📄/📊 导出”用于导出 CSV 或 Excel，方便离线分析、共享与备份。

**校验规则：**

| 项目 | 规则 |
|------|------|
| 温度 | 100-1000 K 范围 |
| 压力 | 0-10000 MPa 范围 |
| 组分 | 0-1 之间 |
| 总和 | 接近 1.0（软/硬阈值） |

**导入预校验示例（curl）：**

```bash
curl -X POST http://127.0.0.1:8000/api/import/preview ^
  -H "Authorization: Bearer <token>" ^
  -F "file=@sample.csv"
```

**预校验响应示例：**

```json
{
  "success": true,
  "data": {
    "summary": {
      "total": 120,
      "valid_count": 118,
      "invalid_count": 2,
      "warning_count": 3,
      "skipped_count": 0
    },
    "errors": [
      { "row": 9, "errors": ["第pressure列: 压力不能为空"] }
    ],
    "warnings": [
      { "row": 12, "warnings": ["压力 12.000 MPa 高于 10 MPa，可能为异常值"] }
    ]
  }
}
```

---

### 3.5 数据审核接口

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/review/duplicates` | 查找重复数据 | 是 |
| POST | `/api/review/move-duplicates` | 迁移至待审核 | 是 |
| GET | `/api/review/pending` | 查询待审核分组 | 是 |
| PUT | `/api/review/pressure/{id}` | 修正待审核压力 | 是 |
| POST | `/api/review/approve/{group_id}` | 审核通过 | 是 |
| POST | `/api/review/reject/{group_id}` | 拒绝整组 | 是 |
| POST | `/api/review/restore/{group_id}` | 恢复到待审核 | 是 |

**数据审核模块界面：**

![数据审核](screenshots/admin-review.png)

**图片说明：**数据审核页面用于集中处理同组分同温度下存在多个压力值的异常记录。页面会汇总待审核组数与记录数，帮助管理员快速评估待处理规模，并通过筛选条件定位特定组。该页面是保障数据质量的关键环节，建议在批量导入后优先进行检查。

**重要按钮/图标说明：**“扫描重复数据”用于全库检测潜在重复记录，适合在数据批量导入后执行；“移到待审核区”会把检测到的重复记录移出正式数据表，进入审核队列以避免干扰查询；“批量通过/拒绝”可对选中的数据组集中处理，显著提升审核效率与一致性。

**重复数据检测示例：**

```bash
curl -X GET http://127.0.0.1:8000/api/review/duplicates ^
  -H "Authorization: Bearer <token>"
```

**响应示例（节选）：**

```json
{
  "success": true,
  "data": [
    {
      "temperature": 275,
      "count": 3,
      "ids": [101, 205, 388],
      "pressures": [2.4, 2.5, 2.7]
    }
  ],
  "count": 1
}
```

---

### 3.6 备份与恢复 API

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/backup/status` | 备份状态 | 是 |
| GET | `/api/backup/list` | 备份列表 | 是 |
| POST | `/api/backup/create` | 创建备份 | 是 |
| POST | `/api/backup/restore/{filename}` | 恢复备份 | 是 |
| DELETE | `/api/backup/{filename}` | 删除备份 | 是 |
| GET | `/api/backup/download/{filename}` | 下载备份 | 是 |

**备份管理模块界面：**

![备份管理](screenshots/admin-backup.png)

**图片说明：**备份管理界面集中展示备份数量、总大小、备份间隔与备份文件列表，是数据安全状态的核心观察窗口。通过该页可快速确认备份是否持续生成、备份是否正常保留以及备份大小是否异常增长。建议将此页面作为数据安全巡检的固定入口。

**重要按钮/图标说明：**“➕ 立即备份”用于手动触发备份，适合在数据大批量更新前后执行；列表中的“下载/恢复/删除”用于单个备份文件的管理操作，恢复前应确认当前数据是否已备份；“🔄 刷新”用于更新备份状态与列表显示，避免信息滞后。

**说明：**

- SQLite 支持本地备份与恢复  
- MySQL 使用托管备份，接口会返回提示信息

**创建备份示例：**

```bash
curl -X POST http://127.0.0.1:8000/api/backup/create ^
  -H "Authorization: Bearer <token>"
```

**响应示例：**

```json
{
  "success": true,
  "message": "备份创建成功",
  "data": {
    "path": "backups/gas_data_manual_20260128_031230.db"
  }
}
```

---

### 3.7 安全与审计接口

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/security/login-logs` | 登录日志 | 是 |
| GET | `/api/security/audit-logs` | 审计日志 | 是 |
| GET | `/api/security/rate-limit` | 限流状态 | 否 |
| GET | `/api/auth/sessions` | 当前会话列表 | 是 |
| POST | `/api/auth/sessions/revoke-all` | 撤销除当前会话外所有会话 | 是 |

**登录日志模块界面：**

![登录日志](screenshots/admin-logs.png)

**图片说明：**登录日志页面用于追踪用户登录与关键操作记录，帮助快速定位异常访问或权限滥用问题。该页面适合安全巡检、审计复盘与异常处理场景，建议定期查看并与系统告警联动。

**重要按钮/图标说明：**“🔄 刷新”用于重新拉取日志记录，确保信息为最新；“清空日志”仅清理页面展示的操作日志，不影响数据库中的审计记录，常用于聚焦近期操作。

**查看限流状态示例：**

```bash
curl http://127.0.0.1:8000/api/security/rate-limit
```

**响应示例：**

```json
{
  "success": true,
  "data": {
    "ip": "127.0.0.1",
    "requests_in_window": 12,
    "max_requests": 60,
    "window_seconds": 60,
    "is_blocked": false,
    "block_remaining_seconds": 0
  }
}
```

---

## 四、数据统计与可视化

### 4.1 统计信息

后端提供数据统计接口，可直接用于监控与报表：

| 统计项 | 说明 |
|--------|------|
| 总记录数 | 数据库中的记录总数 |
| 温度范围 | 最低温度 - 最高温度 |
| 平均温度 | 所有记录的温度平均值 |
| 压力范围 | 最低压力 - 最高压力 |
| 平均压力 | 所有记录的压力平均值 |

### 4.2 图表类型

后端提供多种图表数据接口，客户端或其他分析工具可直接使用：

| 图表类型 | 说明 | 访问路径 |
|---------|------|---------|
| 温度分布图 | 显示温度数据的分布情况 | `/api/chart/temperature` |
| 压力分布图 | 显示压力数据的分布情况 | `/api/chart/pressure` |
| 温度-压力散点图 | 展示温度与压力的关系 | `/api/chart/scatter` |
| 密度热力图 | 温度-压力数据密度分布 | `/api/chart/heatmap` |

**可视化模块界面：**

![高级可视化](screenshots/admin-visualization.png)

**图片说明：**高级可视化页面展示温度-压力散点图，颜色根据压力区间渐变，可直观观察数据分布趋势与异常点。该视图适合在数据筛查、异常识别或趋势分析时使用，能够快速定位密集区域与离群点。

**重要按钮/图标说明：**“刷新图表”用于重新加载散点数据，适合数据更新后进行同步；图例/色带用于解释颜色与压力区间的对应关系，帮助快速识别高压或低压区域并进行对比分析。

---

## 五、API 接口说明

### 5.1 接口概览

系统提供完整的 RESTful API，可通过以下地址访问交互式文档：
```
http://服务器地址:8000/docs
```

### 5.2 认证方式

大部分 API 需要 JWT 令牌认证：

```http
Authorization: Bearer <token>
```

获取令牌流程：
1. 调用登录接口 `POST /api/auth/login`
2. 从响应中获取 `access_token`
3. 在后续请求中携带令牌

### 5.3 主要接口列表

#### 5.3.1 数据记录接口

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/records` | 获取记录列表（分页） | 否 |
| GET | `/api/records/{id}` | 获取单条记录 | 否 |
| POST | `/api/records` | 创建记录 | 是 |
| PUT | `/api/records/{id}` | 更新记录 | 是 |
| DELETE | `/api/records/{id}` | 删除记录 | 是 |

#### 5.3.2 查询接口

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/query` | 按组分查询 | 否 |
| POST | `/api/query/by-components` | 按组分组合+温度查询 | 否 |
| POST | `/api/query/hydrate` | 水合物相平衡查询 | 否 |
| POST | `/api/components/available` | 查询可用组分 | 否 |
| POST | `/api/components/ranges` | 查询组分区间 | 否 |

#### 5.3.3 认证接口

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| POST | `/api/auth/login` | 用户登录 | 否 |
| POST | `/api/auth/logout` | 退出登录 | 是 |
| GET | `/api/auth/me` | 获取当前用户 | 是 |
| POST | `/api/auth/change-password` | 修改密码 | 是 |

#### 5.3.4 导入导出接口

| 方法 | 路径 | 说明 | 认证 |
|------|------|------|------|
| GET | `/api/export/csv` | 导出 CSV | 是 |
| GET | `/api/export/excel` | 导出 Excel | 是 |
| POST | `/api/import` | 导入文件 | 是 |
| GET | `/api/template/csv` | 下载 CSV 模板 | 否 |
| GET | `/api/template/excel` | 下载 Excel 模板 | 否 |

### 5.4 响应格式

**成功响应：**
```json
{
  "success": true,
  "message": "操作成功",
  "data": { ... }
}
```

**错误响应：**
```json
{
  "detail": "错误信息"
}
```

### 5.5 HTTP 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未认证/令牌无效 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 429 | 请求过于频繁（触发限流） |
| 500 | 服务器内部错误 |

---

## 六、系统安装与配置

### 6.1 环境要求

| 项目 | 要求 |
|------|------|
| 操作系统 | Windows / Linux / macOS |
| Python 版本 | 3.8 或更高 |
| 内存 | 建议 2GB 以上 |
| 硬盘空间 | 至少 500MB 可用空间 |

### 6.2 安装步骤

**步骤一：安装 Python 依赖**

```bash
cd backend
pip install -r requirements.txt
```

**依赖包列表：**

| 包名 | 版本 | 用途 |
|------|------|------|
| fastapi | 0.104.1 | Web 框架 |
| uvicorn | 0.24.0 | ASGI 服务器 |
| pydantic | 2.5.2 | 数据验证 |
| python-multipart | 0.0.6 | 文件上传 |
| pandas | >=2.0.0 | 数据处理 |
| openpyxl | >=3.1.0 | Excel 支持 |
| pymysql | 1.1.0 | MySQL 连接 |
| DBUtils | 3.1.0 | 数据库连接池 |
| redis | 5.0.1 | 缓存支持 |

**步骤二：初始化数据库**

```bash
python init_db.py
```

**步骤三：启动服务**

```bash
cd backend
python main.py
```

或使用 uvicorn：

```bash
uvicorn backend.main:app --host 127.0.0.1 --port 8000 --reload
```

### 6.3 环境变量配置

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| `DATABASE_PATH` | SQLite 数据库文件路径 | `gas_data.db` |
| `SECURITY_DB_PATH` | 安全数据库文件路径 | `security.db` |
| `DATABASE_URL` | MySQL 连接字符串（优先于 SQLite） | 空 |
| `BACKUP_DIR` | 备份文件存储目录 | `backups` |
| `SECRET_KEY` | JWT 加密密钥 | 默认值（生产环境必须修改） |
| `ADMIN_PASSWORD` | 管理员初始密码 | 空（必须设置） |
| `CORS_ORIGINS` | 允许的跨域来源 | 空 |

**环境变量设置示例：**

Windows:
```cmd
set ADMIN_PASSWORD=your_secure_password
set SECRET_KEY=your_secret_key_here
```

Linux/macOS:
```bash
export ADMIN_PASSWORD=your_secure_password
export SECRET_KEY=your_secret_key_here
```

### 6.4 Docker 部署

```bash
docker-compose up -d
```

### 6.5 访问地址

| 入口 | 地址 |
|------|------|
| API 基础地址 | http://127.0.0.1:8000/api |
| API 文档 | http://127.0.0.1:8000/docs |
| OpenAPI 描述 | http://127.0.0.1:8000/openapi.json |

---

## 七、常见问题解答

### Q1: 如何设置管理员密码？

**解答**：在启动服务前，设置环境变量 `ADMIN_PASSWORD`：

```bash
# Windows
set ADMIN_PASSWORD=YourPassword123

# Linux/macOS
export ADMIN_PASSWORD=YourPassword123
```

### Q2: 为什么显示"管理员登录已禁用"？

**解答**：未设置 `ADMIN_PASSWORD` 环境变量。请按 Q1 的方法设置后重启服务。

### Q3: 导入数据时提示校验失败怎么办？

**解答**：检查以下几点：
1. 确保列名与模板完全一致
2. 温度和压力值不能为空或负数
3. 各组分摩尔分数应在 0-1 之间
4. 查看错误详情中的具体行号和原因

### Q4: 如何迁移到 MySQL 数据库？

**解答**：
1. 设置环境变量：
   ```
   DATABASE_URL=mysql+pymysql://user:password@host:3306/database
   ```
2. 运行迁移脚本：
   ```bash
   python scripts/migrate_sqlite_to_mysql.py
   ```

### Q5: API 请求返回 429 错误？

**解答**：触发了 API 限流保护。请稍后重试，或联系管理员调整限流策略。

### Q6: 忘记两步验证码怎么办？

**解答**：
1. 使用启用时保存的备用码登录
2. 如备用码也丢失，联系管理员在数据库中禁用您账户的两步验证

### Q7: 查询没有返回结果？

**解答**：可能原因：
1. 所选组分组合在数据库中没有数据
2. 输入的温度超出数据库记录范围
3. 建议先确认组分组合，查看可用的温度范围

### Q8: 如何查看系统运行状态？

**解答**：
- 数据统计：`GET /api/statistics`
- 备份状态：`GET /api/backup/status`
- 限流状态：`GET /api/security/rate-limit`

### Q9: 密码修改失败提示"不符合要求"？

**解答**：密码需满足以下要求：
- 至少 8 个字符
- 包含大写字母
- 包含小写字母
- 包含数字

### Q10: 如何备份数据？

**解答**：
1. **自动备份**：系统会自动定期备份
2. **手动备份**：调用 `POST /api/backup/create`
3. **下载备份**：调用 `GET /api/backup/download/{filename}`

---

## 八、技术支持

### 8.1 获取帮助

| 资源 | 说明 |
|------|------|
| API 文档 | http://服务器地址:8000/docs |
| 项目文档 | `/docs/` 目录 |
| 运维清单 | `/docs/ops_checklist.md` |
| 部署指南 | `/docs/sae_deploy.md` |

### 8.2 版本历史

| 版本 | 发布日期 | 主要更新 |
|------|---------|---------|
| V4.0 | 2026年1月 | 新增智能组分查询、数据审核模块、增强安全功能 |
| V3.0 | 2025年12月 | 新增两步验证、会话管理、审计日志 |
| V2.0 | 2025年11月 | 新增批量导入导出、数据备份恢复 |
| V1.0 | 2025年10月 | 初始版本，基础数据管理功能 |

---

**文档版本**：V4.0  
**最后更新**：2026年1月  
**编写单位**：气体混合物数据管理系统开发团队

---

*© 2026 Gas Mixture Data Management System. All Rights Reserved.*
